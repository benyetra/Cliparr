services:
  cliparr:
    build: .
    container_name: cliparr
    restart: unless-stopped
    ports:
      - 7879:7879
    environment:
      - PLEX_URL=http://plex:32400          # or http://host.docker.internal:32400
      - CLIPARR_SECRET=change-me-to-a-random-secret
      - CLIPARR_BASE_URL=https://clips.yetimonstah.com  # Must match how users access Cliparr (no port if behind reverse proxy)
      - DEFAULT_TTL_HOURS=24
      - MAX_TTL_HOURS=168
      - MAX_CLIP_DURATION=180
      - MAX_CONCURRENT_TRANSCODES=2
      - CLEANUP_GRACE_HOURS=24
      - HARDWARE_TRANSCODE=none
      # Only needed if Plex's internal file paths differ from this container's /media mount.
      # Example: Plex reports files at /data/Movies/Film.mkv but you mount the same files
      # at /media below â†’ set PLEX_MEDIA_PATH=/data so /data/Movies/Film.mkv becomes /media/Movies/Film.mkv
      # Leave empty if Plex paths already match the /media mount.
      #- PLEX_MEDIA_PATH=/data
    volumes:
      - ./config:/config
      - ./clips:/clips
      - /path/to/plex/media:/media:ro        # Mount your media library (read-only)
    # Uncomment for Intel QSV / VA-API GPU transcoding:
    # devices:
    #   - /dev/dri:/dev/dri
    # Uncomment for NVIDIA GPU transcoding:
    # runtime: nvidia
